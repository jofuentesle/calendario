---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import ContactUs from '~/components/widgets/Contact.astro';

const metadata = {
  title: 'Contact',
};
---

<Layout metadata={metadata}>
  <!-- HeroText Widget ******************* -->

  <HeroText tagline="Contact" title="Let's Connect!" />

  <!-- ContactUs Form Component ******************* -->
  <ContactUs
    id="form-contact"
    title="Drop us a message today!"
    subtitle="For quicker answers, explore our FAQs section. You may find the solution you're looking for right there! If not, our support team is delighted to help you."
    inputs={[
      {
        type: 'text',
        name: 'name',
        label: 'Name',
        required: false,
      },
      {
        type: 'tel',
        name: 'phone',
        label: 'Phone',
        required: true,
      },
      {
        type: 'email',
        name: 'email',
        label: 'Email',
        required: true,
      },
      {
        type: 'text',
        name: 'company',
        label: 'Company',
        required: false,
      },
      {
        type: 'select',
        name: 'quantity',
        label: 'Quantity',
        options: [
          { label: '100 units', value: '100' },
          { label: '200 units', value: '200' },
          { label: '500 units', value: '500' },
          { label: '750 units', value: '750' },
          { label: '1000 units', value: '1000' },
        ],
        required: true,
      },
    ]}
    checkbox={{
      name: 'privacy',
      label: 'I accept the privacy policy',
      required: true,
    }}
    disclaimer={{
      label: 'By submitting this contact form, you agree to the collection of your personal information.',
    }}
    description="Our support team typically responds within 24 business hours."
  />
</Layout>

<script is:client>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('#form-contact');

    if (form) {
      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        const formData = new FormData(event.target);
        const data = Object.fromEntries(formData.entries());

        // Seleccionar el elemento para mostrar feedback
        const feedback = document.createElement('p');
        feedback.classList.add('mt-4', 'text-sm', 'text-gray-600');
        form.appendChild(feedback);

        try {
          const response = await fetch('/api/send-email', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
          });

          const result = await response.json();

          if (response.ok) {
            feedback.textContent = 'Formulario enviado exitosamente. Nos pondremos en contacto pronto.';
            feedback.classList.add('text-green-600');
          } else {
            feedback.textContent = `Error al enviar el formulario: ${result.error || response.statusText}`;
            feedback.classList.add('text-red-600');
            console.error('Error del servidor:', result);
          }
        } catch (error) {
          console.error('Error en la solicitud:', error);
          feedback.textContent = 'Error inesperado al enviar el formulario.';
          feedback.classList.add('text-red-600');
        }
      });
    }
  });
</script>
