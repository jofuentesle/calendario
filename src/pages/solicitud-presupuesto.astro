---
import Layout from '~/layouts/PageLayout.astro';
import ContactUs from '~/components/widgets/Contact.astro';
import Features2 from '~/components/widgets/Features2.astro';
import Headline from '~/components/ui/Headline.astro';

const metadata = {
  title: 'Solicitud de presupuesto para Calendarios',
  jsonLd: {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Calendarios Personalizados para empresa 2025",
    "url": "https://calendarios.reprodisseny.com",
    "logo": "",
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "+34 932 749 890",
      "contactType": "Atención al Cliente",
      "email": "comercial@reprodisseny.com",
      "areaServed": "ES",
      "availableLanguage": ["es", "en"]
    },
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "Juan de Mena, 19",
      "addressLocality": "Barcelona",
      "addressRegion": "Cataluña",
      "postalCode": "08035",
      "addressCountry": "ES"
    },
    "sameAs": [
      "https://www.instagram.com/reprodissenybcn/?hl=es",
      "https://es.linkedin.com/company/repro-disseny-s.l"
    ],
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://calendarios.reprodisseny.com/busqueda?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
};
---

<Layout metadata={metadata}>
  <Headline 
    title="Solicitar presupuesto para tus Calendarios Personalizados" 
    subtitle="Conéctate con nosotros para personalizar el calendario perfecto y promocionar tu marca todo el año." 
  />

  <ContactUs
    id="form-contact"
    method="GET"
    action="/api/send-email"
    inputs={[
      {
        type: 'text',
        name: 'nombre',
        label: 'Nombre',
      },
      {
        type: 'email',
        name: 'email',
        label: 'Correo electrónico',
        required: true,
      },
      {
        type: 'tel',
        name: 'telefono',
        label: 'Teléfono',
        required: true,
      },
      {
        type: 'select',
        name: 'cantidad',
        label: 'Cantidad',
        options: [
          { value: '100', label: '100' },
          { value: '200', label: '200' },
          { value: '500', label: '500' },
          { value: '750', label: '750' },
          { value: '1000', label: '1000' },
        ],
        required: true,
      },
      {
        type: 'select',
        name: 'tipo_calendario',
        label: 'Tipo de calendario',
        options: [
          { value: 'mesa_espiral', label: 'Mesa Espiral' },
          { value: 'mesa_triangular', label: 'Mesa Triangular' },
          { value: 'pared_espiral', label: 'Pared Espiral' },
          { value: 'pared_revista', label: 'Pared Revista' },
        ],
        required: true,
      }
    ]}
    disclaimer={{
      label: 'Acepto las políticas de privacidad',
      required: true,
    }}
    description="Nuestro equipo de soporte generalmente responde dentro de las 24 horas hábiles."
  />
  
  
</Layout>

<script>
  // Obtener referencias a los elementos del formulario con el tipo correcto
  const form = document.getElementById('form-contact');
  const emailInput = form?.querySelector('input[name="email"]') as HTMLInputElement;  // Cast a HTMLInputElement
  const telefonoInput = form?.querySelector('input[name="telefono"]') as HTMLInputElement;  // Cast a HTMLInputElement
  const privacidadInput = form?.querySelector('input[name="disclaimer"]') as HTMLInputElement;  // Cast a HTMLInputElement
  const submitButton = form?.querySelector('button[type="submit"]') as HTMLButtonElement;  // Cast a HTMLButtonElement

  // Regex para validar el email y el teléfono
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  const telefonoPattern = /^[0-9]{9}$/; // Ajustado para un número español

  function validateEmail() {
    return emailPattern.test(emailInput.value);  // Ahora puedes acceder correctamente a .value
  }

  function validateTelefono() {
    return telefonoPattern.test(telefonoInput.value);  // Ahora puedes acceder correctamente a .value
  }

          if (response.ok) {
            feedback.textContent = 'Correo enviado correctamente';
            feedback.classList.remove('hidden');
            feedback.classList.remove('bg-red-500');
            feedback.classList.add('bg-green-500');
            formElemet.reset();  
            
            // Limpiar el formulario
            setTimeout(() => {
              window.location.href = '/';  // Redirigir a home
              window.location.reload();  // Recargar la página
            }, 2000);  // Espera 2 segundos antes de redirigir

             // Limpiar el formulario
          } else {
            feedback.textContent = 'Error al enviar el correo';
            feedback.classList.remove('hidden');
            feedback.classList.remove('bg-green-500');
            feedback.classList.add('bg-red-500');
          }
        } catch (error) {
          console.error('Error al enviar el formulario:', error);
          feedback.textContent = 'Error en el envío del formulario';
          feedback.classList.remove('hidden');
          feedback.classList.remove('bg-green-500');
          feedback.classList.add('bg-red-500');
        }
      });
    } else {
      submitButton.disabled = true;  // Deshabilitar si algo está mal
    }
  }

  // Event listeners
  emailInput.addEventListener('input', validateForm);
  telefonoInput.addEventListener('input', validateForm);
  privacidadInput.addEventListener('change', validateForm);

  // Deshabilitar el botón de envío por defecto
  submitButton.disabled = true;
</script>

