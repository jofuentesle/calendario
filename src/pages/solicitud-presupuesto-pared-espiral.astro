---
import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';

const metadata = {
  title: 'Solicitud de presupuesto para Calendarios de Pared con Espiral',
};

const tipoCalendario = 'pared-espiral';
const title = 'Solicita tu presupuesto para Calendarios de Pared con Espiral';
const subtitle = 'Rellena el formulario para obtener un presupuesto personalizado para tus calendarios de pared con espiral.';
---

<Layout metadata={metadata}>
  <HeroText title={title} subtitle={subtitle} />

  <div class="max-w-xl mx-auto bg-white p-6 rounded-lg shadow-lg">
    <form id="form-presupuesto-pared-espiral" class="space-y-6">
      <!-- Nombre -->
      <div>
        <label for="nombre-pared-espiral" class="block text-sm font-medium text-gray-700">Nombre</label>
        <input
          type="text"
          name="nombre"
          id="nombre-pared-espiral"
          class="block w-full px-4 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          placeholder="Tu nombre"
          required
        />
      </div>

      <!-- Email -->
      <div>
        <label for="email-pared-espiral" class="block text-sm font-medium text-gray-700">Correo electrónico</label>
        <input
          type="email"
          name="email"
          id="email-pared-espiral"
          class="block w-full px-4 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          placeholder="Tu correo"
          required
        />
      </div>

      <!-- Teléfono -->
      <div>
        <label for="telefono-pared-espiral" class="block text-sm font-medium text-gray-700">Teléfono</label>
        <input
          type="tel"
          name="telefono"
          id="telefono-pared-espiral"
          class="block w-full px-4 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          placeholder="Tu teléfono"
          required
        />
      </div>

      <!-- Empresa -->
      <div>
        <label for="empresa-pared-espiral" class="block text-sm font-medium text-gray-700">Empresa (Opcional)</label>
        <input
          type="text"
          name="empresa"
          id="empresa-pared-espiral"
          class="block w-full px-4 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          placeholder="Tu empresa"
        />
      </div>

      <!-- Campo oculto para el tipo de calendario -->
      <input type="hidden" name="tipo" value={tipoCalendario} />

      <!-- Campo oculto para la medida fija -->
      <input type="hidden" name="medida" value="34 x 24 cm (cerrado)" />

      <!-- Selector de cantidad -->
      <div>
        <label for="cantidad-pared-espiral" class="block text-sm font-medium text-gray-700">Cantidad</label>
        <select id="cantidad-pared-espiral" name="cantidad" class="block w-full px-4 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required>
          <option value="100">100</option>
          <option value="200">200</option>
          <option value="500">500</option>
          <option value="750">750</option>
          <option value="1000">1000</option>
        </select>
      </div>

      <!-- Políticas de privacidad -->
      <div class="flex items-center">
        <input
          type="checkbox"
          id="politicas-privacidad-pared-espiral"
          name="politicas-privacidad"
          required
          class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
        />
        <label for="politicas-privacidad-pared-espiral" class="ml-2 block text-sm text-gray-700">
          He leído y acepto las <a href="/politicas-de-privacidad" class="text-blue-500 underline" target="_blank">Políticas de Privacidad</a>.
        </label>
      </div>

      <!-- Feedback messages -->
      <div id="feedback-pared-espiral" class="hidden p-4 text-white rounded-md"></div>

      <button
        type="submit"
        class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        Enviar
      </button>
    </form>
  </div>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('form-presupuesto-pared-espiral');
    const feedback = document.getElementById('feedback-pared-espiral');

    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(e.target);  // Obtener los datos del formulario
        const data = Object.fromEntries(formData.entries());  // Convertir a objeto

        try {
          const response = await fetch('/api/send-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          });

          if (response.ok) {
            feedback.textContent = 'Correo enviado correctamente';
            feedback.classList.remove('hidden', 'bg-red-500');
            feedback.classList.add('bg-green-500');
            form.reset();

            // Redireccionar a la página de inicio después de 3 segundos
            setTimeout(() => {
              window.location.href = '/';
            }, 3000);
          } else {
            feedback.textContent = 'Error al enviar el correo';
            feedback.classList.remove('hidden', 'bg-green-500');
            feedback.classList.add('bg-red-500');
          }
        } catch (error) {
          console.error('Error al enviar el formulario:', error);
          feedback.textContent = 'Error en el envío del formulario';
          feedback.classList.remove('hidden', 'bg-green-500');
          feedback.classList.add('bg-red-500');
        }
      });
    } else {
      console.error('Formulario no encontrado');
    }
  });
</script>
