---
import Layout from '~/layouts/PageLayout.astro';
import FormContainer from '~/components/ui/Form.astro';
import Headline from '~/components/ui/Headline.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';

const metadata = {
  title: 'Solicitar presupuesto calendarios',
};

// Obtener el parámetro 'tipo' de la URL
const tipoCalendario = Astro.url.searchParams.get('tipo');

// Definir valores por defecto según el tipo de calendario
const calendarOptions = {
  'mesa-espiral': { title: 'Calendarios de Mesa Espiral', medidas: ['15x15 cm', '21x10 cm'] },
  'pared-espiral': { title: 'Calendarios de Pared Espiral', medidas: ['38x48 cm'] },
};

const tipoCalendarioValido = calendarOptions[tipoCalendario] ? tipoCalendario : 'mesa-espiral';
const { medidas: medidasDefault } = calendarOptions[tipoCalendarioValido];

// Definir inputs para el formulario
const inputs = [
  { type: 'text', name: 'name', label: 'Nombre', required: true },
  { type: 'email', name: 'email', label: 'Email', required: true },
  { type: 'tel', name: 'telefono', label: 'Teléfono', required: true },
  {
    type: 'select', name: 'tipo', label: 'Tipo de Calendario', required: true,
    options: Object.keys(calendarOptions).map(key => ({ value: key, label: calendarOptions[key].title })),
  },
  {
    type: 'select', name: 'medida', label: 'Medida', required: true,
    options: medidasDefault.map(medida => ({ value: medida, label: medida })),
  },
];

const disclaimer = { label: 'Acepto la política de privacidad.' };
const button = 'Solicitar presupuesto';
const description = 'Completa el formulario para solicitar un presupuesto.';
---

<Layout metadata={metadata}>
  <WidgetWrapper id="form-widget" isDark={false} containerClass="max-w-7xl mx-auto">
    <Headline title="Solicita tu presupuesto personalizado" />
    
    <!-- Formulario dinámico -->
    <div class="max-w-xl mx-auto bg-white shadow p-6">
      <FormContainer
        inputs={inputs}
        disclaimer={disclaimer}
        button={button}
        description={description}
      />
      <div id="form-feedback" class="hidden mt-4"></div>
    </div>
  </WidgetWrapper>

  <!-- Script para actualizar dinámicamente las medidas -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.querySelector('#contact-form');
      const tipoSelect = form.querySelector('select[name="tipo"]');
      const medidaSelect = form.querySelector('select[name="medida"]');

      const medidas = {
        'mesa-espiral': ['15x15 cm', '21x10 cm'],
        'pared-espiral': ['38x48 cm'],
      };

      tipoSelect.addEventListener('change', (event) => {
        const selectedTipo = event.target.value;
        medidaSelect.innerHTML = '';
        medidas[selectedTipo].forEach(medida => {
          const option = document.createElement('option');
          option.value = medida;
          option.textContent = medida;
          medidaSelect.appendChild(option);
        });
      });
    });
  </script>
</Layout>
