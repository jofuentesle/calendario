  ---
  import Layout from '~/layouts/PageLayout.astro';

  const metadata = {
    title: 'Solicitud de presupuesto',
  };

  // Constante para el tipo de calendario
  const tipoCalendario = 'mesa-espiral';


  ---

  <Layout metadata={metadata}>
    
    <div class="max-w-xl mx-auto bg-white p-6 rounded-lg shadow-lg">
      <form id="form-presupuesto" class="space-y-6">
        <div>
          <label for="nombre" class="block text-sm font-medium text-gray-700">Nombre</label>
          <input
            type="text"
            name="nombre"
            id="nombre"
            class="block w-full px-4 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            placeholder="Tu nombre"
            required
          />
        </div>

        <div>
          <label for="email" class="block text-sm font-medium text-gray-700">Correo electrónico</label>
          <input
            type="email"
            name="email"
            id="email"
            class="block w-full px-4 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            placeholder="Tu correo"
            required
          />
        </div>

        <div>
          <label for="telefono" class="block text-sm font-medium text-gray-700">Teléfono</label>
          <input
            type="tel"
            name="telefono"
            id="telefono"
            class="block w-full px-4 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            placeholder="Tu teléfono"
            required
          />
        </div>

        <div>
          <label for="empresa" class="block text-sm font-medium text-gray-700">Empresa (Opcional)</label>
          <input
            type="text"
            name="empresa"
            id="empresa"
            class="block w-full px-4 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            placeholder="Tu empresa"
          />
        </div>

        <!-- Campo oculto para el tipo de calendario -->
        <input type="hidden" name="tipo" value={tipoCalendario} />

        <!-- Selector de medidas -->
        <div>
          <label for="medida" class="block text-sm font-medium text-gray-700">Medida</label>
          <select
            id="medida"
            name="medida"
            class="block w-full px-4 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            required
          >
            <option value="15x15 cm">15x15 cm</option>
            <option value="21x10 cm">21x10 cm</option>
            <option value="Din A5">Din A5</option>
          </select>
        </div>
        <div> 
        <!-- Cantidad de calendarios -->
        <label for="cantidad" class="block text-sm font-medium text-gray-700">Cantidad</label>
        <select id="cantidad" name="cantidad" class="block w-full px-4 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required>
          <option value="100">100</option>
          <option value="200">200</option>
          <option value="500">500</option>
          <option value="750">750</option>
          <option value="1000">1000</option>
        </select>
      </div>

        <!-- Feedback messages -->
        <div id="feedback" class="hidden p-4 text-white rounded-md"></div>

        <button
          type="submit"
          class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          Enviar
        </button>
      </form>
    </div>
  </Layout>

  <script>
    document.getElementById('form-presupuesto').addEventListener('submit', async (e) => {
      e.preventDefault();  // Evita recargar la página
  
      const formData = new FormData(e.target);  // Obtener los datos del formulario
      const data = Object.fromEntries(formData.entries());  // Convertir a objeto
  
      try {
        const response = await fetch('/api/send-email', {  // Llama a la función del servidor
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
  
        if (response.ok) {
          alert('Formulario enviado correctamente');
          e.target.reset();  // Limpiar el formulario
        } else {
          alert('Error al enviar el formulario');
        }
      } catch (error) {
        console.error('Error al enviar el formulario:', error);
        alert('Error en el envío del formulario');
      }
    });
  </script>
