---
import Layout from '~/layouts/PageLayout.astro';
import sendGrid from '@sendgrid/mail';
import FormContainer from '~/components/ui/Form.astro';
import Headline from '~/components/ui/Headline.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';

// Configuración de SendGrid
sendGrid.setApiKey(import.meta.env.SENDGRID_API_KEY);

const metadata = {
  title: 'Solicitar presupuesto calendarios',
};

// Obtener el parámetro 'tipo' de la URL
const tipoCalendario = Astro.url.searchParams.get('tipo') || 'mesa-espiral';

// Definir los valores por defecto para cada tipo de calendario
const calendarOptions = {
  'mesa-espiral': {
    title: 'Mesa Espiral',
    subtitle: 'Personaliza tus calendarios de mesa con espiral y promociona tu marca durante todo el año.',
    medidas: ['15x15 cm', '21x10 cm', 'Din A5'],
  },
  'mesa-triangular': {
    title: 'Mesa Triangular',
    subtitle: 'Perfectos para oficinas y mesas de trabajo, personaliza tus calendarios triangulares.',
    medidas: ['15x15 cm', '21x10 cm', 'Din A5'],
  },
  'pared-espiral': {
    title: 'Pared Espiral',
    subtitle: 'Promociona tu marca durante todo el año con nuestros calendarios de pared con espiral.',
    medidas: ['38x48 cm'],
  },
  'pared-revista': {
    title: 'Pared Revista',
    subtitle: 'Nuestros calendarios tipo revista son perfectos para destacar tu marca de manera elegante.',
    medidas: ['34 x 24 cm (cerrado)'],
  },
};

// Entradas del formulario
const inputs = [
  { type: 'select', name: 'tipo', label: 'Tipo Calendario', options: [
      { value: 'mesa-espiral', label: 'Mesa Espiral' },
      { value: 'mesa-triangular', label: 'Mesa Triangular' },
      { value: 'pared-espiral', label: 'Pared Espiral' },
      { value: 'pared-revista', label: 'Pared Revista' },
    ]
  },
  { type: 'select', name: 'medida', label: 'Medida Calendario', options: calendarOptions[tipoCalendario].medidas },
  // Otros inputs...
];

function updateMeasures(tipo) {
  const medidaSelect = document.querySelector('select[name="medida"]');
  medidaSelect.innerHTML = ''; // Limpiar las opciones actuales

  const medidasDelTipo = calendarOptions[tipo].medidas || [];
  medidasDelTipo.forEach(medida => {
    const option = document.createElement('option');
    option.value = medida;
    option.textContent = medida;
    medidaSelect.appendChild(option);
  });
}

function handleTipoChange(event) {
  updateMeasures(event.target.value);
}

document.addEventListener('DOMContentLoaded', () => {
  const tipoSelect = document.querySelector('select[name="tipo"]');
  tipoSelect.addEventListener('change', handleTipoChange);

  // Inicializar las medidas para el tipo seleccionado inicialmente
  updateMeasures(tipoSelect.value);
});
---

<Layout metadata={metadata}>
  <WidgetWrapper containerClass="max-w-7xl mx-auto">
    <Headline title="Solicitar presupuesto para tus Calendarios Personalizados" subtitle="Conéctate con nosotros para personalizar el calendario perfecto y promocionar tu marca todo el año." />
    
    <!-- Formulario -->
    <FormContainer inputs={inputs} />
  </WidgetWrapper>
</Layout>
